<div class="controls">
  <button 
    onmousedown="harvesting=true" 
    onmouseup="harvesting=false" 
    ontouchstart="harvesting=true" 
    ontouchend="harvesting=false"
  >ðŸŒ¾</button>
</div>

<script>
let harvesting = false; // à¦¨à¦¤à§à¦¨ à¦­à§à¦¯à¦¾à¦°à¦¿à§Ÿà§‡à¦¬à¦²

document.addEventListener("keydown", e=>{
  if(e.key===" ") harvesting = true;
});
document.addEventListener("keyup", e=>{
  if(e.key===" ") harvesting = false;
});

// à¦†à¦—à§‡à¦° draw() à¦«à¦¾à¦‚à¦¶à¦¨ à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¨ à¦•à¦°à§‡ à¦à¦•à¦Ÿà¦¾ update() à¦¬à¦¾à¦¨à¦¾à¦šà§à¦›à¦¿
function update(){
  if(harvesting && energy>0 && !gameOver) harvest();

  // à¦¸à¦¬ à¦†à¦—à§‡à¦° draw()-à¦à¦° à¦•à§‹à¦¡ à¦à¦–à¦¾à¦¨à§‡ à¦°à¦¾à¦–à¦¤à§‡ à¦¹à¦¬à§‡
  ctx.clearRect(0,0,canvas.width,canvas.height);

  items.forEach(i=>{
    i.y+=1.5+level*0.4;
    ctx.fillStyle=i.c;
    ctx.beginPath();
    ctx.arc(i.x+i.size/2,i.y+i.size/2,i.size/2,0,Math.PI*2);
    ctx.fill();

    if(i.y>canvas.height){
      if(i.t!=="weed") life--;
      i.dead=true;
    }
  });

  for(let i=items.length-1;i>=0;i--)
    if(items[i].dead) items.splice(i,1);

  ctx.fillStyle="#fbbf24";
  ctx.fillRect(farmer.x,farmer.y,farmer.w,farmer.h);

  document.getElementById("life").innerText=life;
  document.getElementById("energy").innerText=energy;
  document.getElementById("score").innerText=score;
  document.getElementById("level").innerText=level;

  if(life<=0){
    ctx.fillStyle="#f87171";
    ctx.font="28px Arial";
    ctx.fillText("GAME OVER",90,260);
    gameOver=true;
    return;
  }

  requestAnimationFrame(update);
}

update(); // à¦à¦–à¦¨ draw() à¦à¦° à¦œà¦¾à§Ÿà¦—à¦¾à§Ÿ update() à¦•à¦² à¦¹à¦šà§à¦›à§‡
</script>
